
# Minimum Spanning Tree (MST) Project

## Overview

This project implements the **Minimum Spanning Tree (MST)** problem using two classic algorithms: **Prim's** and **Kruskal's**. The project employs the **Factory Pattern** for dynamic algorithm selection, allowing you to choose between these two algorithms at runtime. Additionally, the project includes multithreaded server implementations using both the **Pipeline Pattern with Active Object** and **Leader-Follower Thread Pool** patterns to handle client requests efficiently.

---

## Class Overview and Method Signatures

### 1. `Graph` Class
The `Graph` class represents an undirected graph where edges have weights. It stores vertices and edges and provides methods to add/remove edges and retrieve the graph structure.

**Attributes:**
- `vertices`: The number of vertices in the graph.
- `edges`: A vector storing edges as pairs `(weight, {u, v})`.

**Methods:**
```cpp
Graph(int v);
// Initializes the graph with a given number of vertices.

bool addEdge(int u, int v, int weight);
// Adds an edge between vertices u and v with a given weight. Returns false if the edge already exists.

int getVertices() const;
// Returns the number of vertices in the graph.

const vector<pair<int, pair<int, int>>>& getEdges() const;
// Returns the list of edges in the graph.

bool removeEdge(int u, int v);
// Removes the edge between vertices u and v. Returns true if successful, false if the edge is not found.

void printGraph() const;
// Prints the list of edges in the format `u -- v == weight`.
```

### 2. `Tree` Class
The `Tree` class represents the **Minimum Spanning Tree** generated by the MST algorithms. It stores the MST edges and provides methods to calculate the total cost and print the tree.

**Attributes:**
- `vertices`: Number of vertices in the tree.
- `mst_edges`: A vector storing edges of the MST.

**Methods:**
```cpp
Tree(int v);
// Initializes an empty tree with the given number of vertices.

void addEdge(int u, int v, int weight);
// Adds an edge to the MST.

void printTree() const;
// Prints the edges of the MST.

int getMSTCost() const;
// Returns the total cost of the MST (sum of edge weights).

const vector<pair<int, pair<int, int>>>& getEdges() const;
// Returns the list of edges in the MST.
```

### 3. `MSTSolver` Class (Abstract Base Class)
Defines the interface for MST algorithms.

**Methods:**
```cpp
virtual Tree solveMST(const Graph& graph) = 0;
// Must be implemented by derived classes to solve the MST.
```

### 4. `KruskalMST` Class
Implements **Kruskal's Algorithm** for solving the MST. It sorts edges by weight and adds them to the MST in non-decreasing order, ensuring no cycles using union-find.

**Methods:**
```cpp
Tree solveMST(const Graph& graph) override;
// Solves the MST using Kruskal's Algorithm and returns the result.
```

### 5. `PrimMST` Class
Implements **Prim's Algorithm** for solving the MST. It grows the MST by adding the smallest edge connecting a vertex inside the MST to a vertex outside of it.

**Methods:**
```cpp
Tree solveMST(const Graph& graph) override;
// Solves the MST using Prim's Algorithm and returns the result.
```

### 6. `MSTFactory` Class
Implements the **Factory Pattern** to dynamically choose the MST algorithm at runtime.

**Methods:**
```cpp
static MSTSolver* getMSTSolver(const std::string &algorithm);
// Returns an instance of the appropriate MST solver (Prim or Kruskal).
```

**Example Usage:**
```cpp
MSTSolver* solver = MSTFactory::getMSTSolver("Kruskal");
Tree mst = solver->solveMST(graph);
mst.printTree();
```

---

## Server Helper Classes

These classes facilitate efficient task management and execution using a **task queue** and **worker threads**.

### 1. `Task` Class
Represents a single client request or task.

**Attributes:**
- `client_sock`: Client socket descriptor.
- `command`: The client's command.
- `operation`: A function or lambda representing the task to execute.

**Constructors:**
```cpp
Task();
// Initializes the task with default values.

Task(int sock, const std::string& cmd, std::function<void()> op);
// Initializes the task with a socket, command, and operation.
```

### 2. `TaskQueue` Class
Manages a thread-safe queue for tasks. It uses mutexes and condition variables for synchronization.

**Methods:**
```cpp
void enqueue(Task task);
// Adds a task to the queue.

bool dequeue(Task& task);
// Removes a task from the queue, or returns false if the queue is stopped.

void stop();
// Stops the task queue and wakes up all waiting threads.
```

### 3. `PipelineWorker` Class
Represents a worker thread that processes tasks from the task queue.

**Methods:**
```cpp
PipelineWorker(TaskQueue& queue);
// Initializes the worker with a reference to the task queue.

void operator()();
// Continuously retrieves and processes tasks from the task queue.
```

---

## Pipeline Pattern Server with Active Object and Client

The **Pipeline Pattern** server processes client commands in three stages: **Request Parsing**, **Processing**, and **Response**. The server uses the **Active Object** pattern, allowing tasks to be handled asynchronously.

### 1. Server Overview
- **Request Parsing**: Validates incoming commands.
- **Processing**: Executes the graph operations or MST calculation.
- **Response**: Sends the result back to the client.

### 2. Client Overview
The client sends commands like `Newgraph`, `Newedge`, `MST Prim`, and `shutdown`. The server processes the commands asynchronously and returns the result to the client.

**Example Commands**:
- `Newgraph 5`: Initializes a graph with 5 vertices.
- `MST Prim`: Calculates the MST using Prim’s algorithm.
- `shutdown`: Shuts down the server.

### 3. Pipeline Execution
Each request flows through three stages:
1. **Request Parsing**
2. **Processing**
3. **Response**

---

## Leader-Follower Thread Pool Server and Client

This implementation uses the **Leader-Follower** pattern, where one thread accepts new client connections, and other threads process the requests.

### 1. Server Overview
The server processes requests to:
- Create graphs (`Newgraph`).
- Add/remove edges (`Newedge`, `Removeedge`).
- Calculate MSTs (`MST Prim`, `MST Kruskal`).

### 2. Leader-Follower Pool
A pool of threads dynamically assigns roles:
- **Leader**: Accepts new client connections.
- **Followers**: Process client requests.

### 3. Client Overview
The client connects to the server and sends commands, receiving the results asynchronously.

**Example Commands**:
- `Newgraph 5`: Initializes a graph with 5 vertices.
- `MST Prim`: Calculates the MST using Prim’s algorithm.
- `shutdown`: Shuts down the server.

### 4. Features
- **Leader-Follower Pattern**: Dynamically assigns threads for handling connections and requests.
- **Thread-Safe Operations**: Mutexes ensure safe access to shared resources.
- **Repeated Requests Shutdown**: If a command is repeated 5 times, the server shuts down.

---

## Summary

This project combines **MST algorithms** with **multithreaded server architectures** using the **Pipeline Pattern** and **Leader-Follower Thread Pool**. The server efficiently handles client requests for graph operations and MST calculations, with the ability to dynamically choose between algorithms at runtime. The system is designed for scalability and efficient resource usage with thread-safe task processing and asynchronous communication.


# section 6 and 7

- valgrind --tool=memcheck ./pipe_server &> pipe_memory.txt

- valgrind --tool=helgrind ./pipe_server > helgrind_output_pipe.txt 2>&1

- valgrind --leak-check=full --track-origins=yes ./pipe_server > valgrind_output1.txt




# Server Architecture Diagrams

## Pipeline Server

```
+---------------------+
|     Main Thread     |
|---------------------|
| - Start Server      |
| - Accept Clients    |
| - Read Client Data  |
| - Enqueue Requests  |
+----------+----------+
           |
           v
+----------+----------+
|  Request Queue      |
+----------+----------+
           |
           v
+----------+----------+        +------------------------+
| Request Worker      |        |   Client Management    |
| Thread              |        |------------------------|
|---------------------|        | - Manage Client Sockets|
| - Parse Requests    |        | - Handle Sessions      |
| - Validate Requests |        +-----------+------------+
| - Enqueue to        |                    |
|   Processing Queue  |                    |
+----------+----------+                    |
           |                               |
           v                               |
+----------+----------+                    |
| Processing Queue    |                    |
+----------+----------+                    |
           |                               |
           v                               |
+----------+----------+                    |
| Processing Worker   |                    |
| Thread              |                    |
|---------------------|                    |
| - Perform MST Calc  |                    |
| - Enqueue to        |                    |
|   Response Queue    |                    |
+----------+----------+                    |
           |                               |
           v                               |
+----------+----------+                    |
| Response Queue      |                    |
+----------+----------+                    |
           |                               |
           v                               |
+----------+----------+                    |
| Response Worker     |                    |
| Thread              |                    |
|---------------------|                    |
| - Send Responses    |                    |
| - Handle Shutdown   |                    |
+----------+----------+                    |
           |                               |
           v                               |
+----------+----------+                    |
|  Shutdown Mechanism | <------------------+
|---------------------|
| - Detect Shutdown   |
| - Stop Queues       |
| - Join Threads      |
| - Clean Up Resources|
+---------------------+
```

## Leaderfollower Server

```
+----------------------------+
|        Main Thread         |
|----------------------------|
| - Initialize Server Socket |
| - Bind & Listen on Port    |
| - Start Leader-Follower    |
|   Thread Pool              |
+------------+---------------+
             |
             v
+------------+---------------+
|   Leader-Follower Pool     |
|----------------------------|
| - Contains Multiple Threads|
| - Manage Leader Election   |
+------+-----+-----+---------+
       |     |     |
       |     |     |
       v     v     v
+------+ +---+ +---+ +---+
|Thread| |Thread| |Thread| |Thread|
|  1   | |  2   | |  3   | |  4   |
|------| |------| |------| |------|
| - Wait to Become Leader       |
| - On Leadership: Accept Client|
| - Handle Client Requests      |
| - Release Leadership          |
+------+ +---+ +---+ +---+
       |     |     |
       |     |     |
       v     v     v
+----------------------------+
|      Client Handler         |
|----------------------------|
| - Read Client Requests      |
| - Parse Commands            |
| - Perform Graph/MST Ops     |
| - Send Responses            |
| - Detect Shutdown Command   |
+------------+---------------+
             |
             v
+------------+---------------+
|      Shutdown Mechanism     |
|----------------------------|
| - Set Shutdown Flag         |
| - Notify All Threads        |
| - Join All Worker Threads   |
| - Close Server Socket       |
| - Clean Up Resources        |
+----------------------------+
```